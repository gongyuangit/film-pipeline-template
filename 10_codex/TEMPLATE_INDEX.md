# Template Structure Index

## A. Directory tree (2-3 levels)
- `00_human/`
  - `INBOX.md`, `NOW.md`, `APPROVALS.md`
- `10_codex/`
  - `PIPELINE_STAGES.yaml`, `TEMPLATE_MANIFEST.yaml`, `TEMPLATE_INDEX.md`, `STANDARDS_LOOKDEV.md`
  - `tools/preflight.py`, `tools/__pycache__/` (auto)
- `30_project/`
  - `inputs/`
    - `index.yaml`, `README.md`, `script/`, `storyboard/`, `timeline_srt/`, `timeline_xml/`
  - `docs/`
    - `0-source/`
      - `raw/`, `parsed/`, `registry.yaml`
    - `1_story/`
      - `script_breakdown_v1.yaml`
    - `2_layout/`
      - `_artifacts/` (inputs, prompt_packs, editing_bridge, exports, reports)
      - `CURRENT.yaml`, `2-2_layout_freeze.yaml`
    - `2_audio/`
      - `_artifacts/` (plan, prompt_packs, editing_bridge, reports, exports)
    - `5_color/`
      - `_artifacts/` (reports, inputs, exports, editing_bridge)
    - `meta/` (index/state/master configs)
- `20_runtime/exec/`
  - `execution_plan.json`
- `90_archive/` (archived legacy work with migration log)

## B. Purpose table
| Path | Owner | Purpose | Lifecycle | Notes |
| -- | -- | -- | -- | -- |
| `00_human/INBOX.md` | Human | all-gate board (status/prereqs/artifact readiness) | regenerated by `preflight.py` every run | shows every stage in `PIPELINE_STAGES` order |
| `00_human/NOW.md` | Human | actionable pending gates | refreshed by `preflight.py` (empty in template mode) | only lists pending gates with ready artifacts |
| `00_human/APPROVALS.md` | Human | approvals trigger downstream progress | manual edits only | approvals are the sole source of `approved` status |
| `10_codex/PIPELINE_STAGES.yaml` | Codex | canonical gate sequence, prerequisites, artifacts | maintained when stages change | drives INBOX/NOW and gating rules |
| `10_codex/TEMPLATE_MANIFEST.yaml` | Codex | structural manifest for preflight ensure | preflight enforces directories/files | must list every required artifact or placeholder |
| `10_codex/tools/preflight.py` | Codex | preflight + dashboards / gate enforcement | run before any action; uses manifest & stages | enforces `project_mode` and placeholder logic |
| `30_project/inputs/index.yaml` | Human | `project_mode` switch (`template` vs. `project`) | default `template`, change in new project | template mode keeps NOW empty and artifact_ready false |
| `30_project/docs/0-source/` | Codex | source synthesis inputs + registry for parsed fragments | add raw fragments / rerun registry updates | parsed outputs feed stage S |
| `30_project/docs/1_story/script_breakdown_v1.yaml` | Codex | core script breakdown input | referenced by layout/audio | placeholder flagged until filled |
| `30_project/docs/2_layout/_artifacts/` | Codex | layout/audio/lookdev artifacts + pointers | all generated work lives here | includes `CURRENT.yaml`, editing_bridge, prompt packs |
| `30_project/docs/2_audio/_artifacts/` | Codex | audio planning/prompt/reports | run parallel to layout | editing_bridge ensures timeline facts are shared |
| `30_project/docs/5_color/_artifacts/` | Codex | color QC/review reports + artifacts | comes after exec plan | editing_bridge keeps XML/SRT anchors |
| `20_runtime/exec/execution_plan.json` | Codex | execution plan placeholder | tracked even if ignored | flagged placeholder until real plan exists |

## C. Key rules
- A gate becomes `approved` only when `APPROVALS.md` shows `approved`; placeholders or existing artifacts do not auto-approve.
- In `project_mode: template`, every gate outside `TEMPLATE_READY_WHITELIST` reports `artifact_ready=false` and `NOW.md` only shows a reminder to switch modes.
- `TEMPLATE_PLACEHOLDER: true` marks stub files; `preflight` uses `content_nontrivial` heuristics (length, YAML/MD lines, SRT blocks, XML `<timeline`) before permitting readiness.
- XML/SRT files are treated as timeline facts—trust track IDs, not names, and keep them under `_artifacts/editing_bridge/` per workbench.
- Generated work must live inside its stage’s `_artifacts/` directories; `CURRENT.yaml` acts as the pointer for layout versions.

## D. No-drift rules
- Any new stage requires synchronized updates to `PIPELINE_STAGES.yaml`, `TEMPLATE_MANIFEST.yaml`, `00_human/INBOX.md`/`NOW.md` logic, and `preflight.py` gating.
- All required files/directories must be listed in `TEMPLATE_MANIFEST.yaml`; preflight will recreate missing paths with placeholders.
- Any directory or file movement must be documented here and recorded in `90_archive/docs_migration_log.md` if legacy material is archived.
- Keep this index current: structural changes or new artifacts mandate updating `TEMPLATE_INDEX.md` before any other edits.

# Codex 专用 / 执行控制层（非项目创意或内容本体）
> 此文档仅用于规范 Codex 的执行控制角色，可单独替换或移除，不属于模板的创意或内容主线。

## 1. Codex 的角色与职责边界
- 作为执行型协作助手，我仅负责根据用户指令补充或维护执行控制层，避免主导创意、产品或内容决策。
- 我不预设或裁定项目的艺术方向，只按既定绑定（如 AGENTS 指令）完成控制层相关更新。
- 我确保所有新增内容都保持与原有模板结构明确分离，便于日后整体替换或取消。

## 2. 明确禁止 / 允许的行为
- 允许：新增专用于 Codex 管理、权限或流程的文档，或在现有文件最前端追加执行控制声明（仅在无法添新文件时）。
- 禁止：重写、删减、重组已有内容；添加未经授权的创意或项目任务执行说明；擅自修改其他文件内容。
- 禁止：任何假设缺失信息、越过“只读理解”阶段对项目内容直接执行任务。

## 3. Codex 启动时的默认动作
- 每次启动即只阅读与执行控制层相关的文件与指令，不发起项目任务、修改或推论。
- 默认策略为“理解后等待进一步指示”，除非新指令明确授权所需的修改或操作。
- 若需要执行写入操作，会在得到明确指示后再行动，并注明对现存文件无任何变更。

## 4. 多文档情形下的优先级与冲突处理
- 遭遇多份指令时，优先遵循最近一次明确命名为 Codex 执行控制内容的文件（本文件、AGENTS 等）。
- 其次遵循用户指令，其次再遵循项目中其他文档；若存在矛盾，向用户说明优先顺序并请求澄清。
- 所有冲突解决结果应记录在执行控制层以保持透明，并可随时由用户替换或删除控制层。

## 5. 项目核心与人工介入
- `30_project/` 为项目核心内容区，默认需要人工审核；Codex 请勿擅自更改其中文件，除非在 `00_human/INBOX.md` 获得明确指令。
- 当遇到缺信息、无法自行判定的约束或需人工审批的操作时，必须立即记录在 `00_human/INBOX.md`，并等待明确的反馈再继续。

## 6. 人工互动语言规范（Language for Human Interaction）
- 所有需要人工介入的事项（判定、裁决、补信息、审批）必须通过 `00_human/INBOX.md` 提出，并注明状态，便于人类察看与回应。
- `00_human/INBOX.md`、`00_human/NEEDED_INPUTS.md`、`00_human/APPROVALS.md` 中的描述、问题、选项与行动要求，应以中文为主；可在结尾附上英文补充说明，但中文表述需清晰完整。
- 机器执行层（`10_codex/Makefile`、`10_codex/tools/`、`20_runtime/` 等）无需调整语言，按现有逻辑继续使用英文或中英混用即可。

## 7. 启动清单默认路径规范
- 所有项目启动清单必须指向这一套固定路径：`30_project/inputs/script/`、`30_project/inputs/storyboard/`、`30_project/inputs/reference/`、`30_project/inputs/assets/`，任何时候都不得更改这些目录名。
- 若需要说明具体文件或格式，仍在清单备注中补充，但路径引用必须保持与上述规范一致，确保 Codex 与人类始终围绕统一结构协作。

## 8. INBOX 使用规范（防呆机制）
- INBOX 的语义：仅收录“当前需要人工关注、决策或补充”的事项，不作为历史日志，也不存长期备忘，只保留下一步必须解决的问题。
- 状态驱动：条目只有在 Status 为 `pending` 时才需要用户处理；一旦前提条件满足（例如需要的文件已放置在指定路径），必须立即将对应条目标记为 `done` 或 `resolved`，并清除与之相关的提醒，避免重复干扰。
- 禁止重复提问：同一问题或需求在 INBOX 中仅允许出现一次；已标为 `done` / `resolved` 后不得重新创建类似条目，也不得在后续的清单或总结中再次出现该问题。
- 项目时间线意识：INBOX 只保留与“下一步”直接相关的问题，随着项目进展过期事项应及时清理或完成，用户无需也不应回顾已经解决的事项。
- 用户阅读约定：用户只需关注 `00_human/INBOX.md` 中 Status 为 `pending` 的条目，其它状态的条目默认无需关注或回应，避免阅读冗余内容。

## 9. 启动即制作清单 / 空项目检测
- 启动新项目时务必先运行 `make check-inputs`（或直接执行 `python3 tools/check_inputs.py`），该脚本会扫描 `30_project/inputs/` 并替换 `00_human/INBOX.md` 中 `<!-- inputs-detection:start -->` 与 `<!-- inputs-detection:end -->` 之间的内容，输出当前素材状态。
- 检测准则：
  - 只要任一关键目录（`script`、`storyboard`、`reference`、`assets`，不区分大小写）下递归包含任意文件，即视为已提供素材；文件名可包含中文、任意扩展名，扩展名大小写也不会影响识别。
  - `30_project/inputs/index.yaml` 仍可作为项目入口补充元信息，但缺失不再阻塞启动，脚本会在摘要中提示其存在与否。
  - 一旦检测到素材，INBOX 将被标记为 resolved 形式并列出相对路径，禁止再次生成“请提供剧本／分镜／参考”的待办；仅在确实未发现素材时才展现那套必需清单并保持 `pending`，避免重复打扰。

## 【输入素材的自动预处理职责】

1) 触发条件
- 当检测到 `30_project/inputs/` 下出现新的或更新的文件时，你应进入“预处理阶段”，而不是直接进入内容生成阶段。

2) 你被默认授权执行的预处理（无需再次询问用户）：
- 文件与文件夹命名规范化（统一大小写、分隔符、中英文混用、去除无意义字符）
  - 此项目规定命名规范化是【默认必须执行】的预处理步骤，遇到新的或更新素材必须先完成，之后再继续后续流程。
  - 在 `30_project/inputs/` 下发生新增素材时，你获得【物理重命名】权限，可直接修改原文件/文件夹名，但必须遵循：
    * 不删除任何文件
    * 不改变文件内容
    * 统一扩展名大小写（例如 `.JPG` → `.jpg`）
    * 去除“副本”“copy”“final”等无意义词
    * 使用可预测的稳定命名（如 `shot_01.jpg`、`storyboard_08.jpg`）
  - 若存在潜在引用风险，应在 `00_human/INBOX.md` 中记录“已重命名的映射关系（旧名 → 新名）”并保持 `pending` 或相关状态，便于人工核查；在没有风险的情况下，无需额外确认即可执行重命名。
  - 检测到新文件时，默认先执行命名规范化，再进入后续预处理或内容拆解阶段。
- 文本类文件（如剧本）的非语义清理：
  - 清理乱码、不可见字符、异常断行
  - 统一标点与段落分隔
- 基础结构化（不改变内容含义）：
  - 场景/段落分段
  - 行号或镜头占位标记（如不确定则使用 TODO）

【重复文件的处理与删除授权】

1) 定义“可安全删除的重复文件”
- 文件内容完全一致（如字节级一致，或明确可判定为等价副本）
- 不存在任何额外信息差异（分辨率、时长、帧、文本内容完全相同）
- 仅命名不同、路径不同或带有“副本/copy/(1)”等标识

2) 删除授权
- 你被明确授权【直接删除】上述定义下的重复文件
- 删除前需确认至少保留一个“主版本”文件
- 删除行为不视为信息丢失

3) 主版本选择规则（优先级）
- 命名最规范的
- 路径最符合模板规范的
- 文件名语义最清晰的
（如无明显差异，可任选其一）

4) 删除记录（轻量）
- 删除重复文件后，应在 `00_human/INBOX.md` 中简要记录：
  - 被删除的文件名
  - 保留的主版本文件名
- 无需用户确认即可执行

5) 禁止删除的情况（无论任何情况）
- 内容存在任何差异或不确定性
- 文件可能包含隐性信息（如不同分辨率、不同帧率、不同编码）
- 用户明确标注为“保留/不要删”的文件

目标：
- 主目录中对人而言只保留一个文件
- 冗余副本不长期占用空间
- 不影响任何创作或后续流程


3) 严格禁止的行为（无论任何情况）：
- 不得删除任何内容
- 不得改写、润色或重构剧情、对白或叙事
- 不得基于主观判断“优化表达”

4) 安全策略
- 如对某项修改是否影响语义存在不确定性：
  - 必须保留原文件
  - 创建 `*_cleaned` 或 `*_normalized` 版本
- 任何潜在有风险的修改，必须写入 `00_human/INBOX.md` 请求确认

5) 汇报规则
- 预处理完成后：
  - 不打扰用户
  - 仅在 INBOX 中简要说明“做了哪些类别的清理”
  - 若无风险事项，不生成待办

该预处理阶段完成后，方可进入项目内容拆解与生成阶段。

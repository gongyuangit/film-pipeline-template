meta:
  role: state_machine
  version: 1.0
  status: draft

schema:
  type: object
  required: [meta, gates]
  properties:
    meta:
      type: object
      required: [role, version]
      properties:
        role: {type: string}
        version: {type: number}
        status: {type: string}
    gates:
      type: array
      items:
        type: object
        required: [id, description, required_docs]
        properties:
          id: {type: string}
          description: {type: string}
          required_docs:
            type: array
            items: {type: string}

fields:
  - path: meta.role
    purpose: 文档角色标识
    type: string
    required: true
    default: state_machine
  - path: meta.version
    purpose: 模板版本
    type: number
    required: true
    default: 1.0
  - path: meta.status
    purpose: 文档状态
    type: string
    required: false
    default: draft
  - path: gates[].id
    purpose: 关卡编号
    type: string
    required: true
    default: "G0_to_G1"
  - path: gates[].description
    purpose: 关卡说明
    type: string
    required: true
    default: ""
  - path: gates[].required_docs
    purpose: 通过所需文档路径
    type: array[string]
    required: true
    default: []

gates:
  - id: "G0_to_G1"
    description: "源头层信息不足，禁止冻结叙事结构"
    required_docs:
      - "30_project/docs/0-source/raw/structured/0-2_world_rules.yaml"
      - "30_project/docs/0-source/raw/structured/0-3_assets_entities.yaml"

  - id: "G1_to_G2"
    description: "镜头清单未冻结，禁止进入 layout 冻结"
    required_docs:
      - "30_project/docs/1_story/script_breakdown_v1.yaml"

  - id: "G2_to_G3"
    description: "layout 未冻结，禁止进入 lookdev 定版"
    required_docs:
      - "30_project/docs/2_layout/2-2_layout_freeze.yaml"

  - id: "G3_to_G4"
    description: "lookdev 未定版，禁止进入规模化生产"
    required_docs:
      - "90_archive/docs/3_lookdev/3-1_lookdev.yaml"

example:
  meta: {role: state_machine, version: 1.0, status: draft}
  gates:
    - id: "G0_to_G1"
      description: "完成源头层后进入下一层"
      required_docs: ["30_project/docs/0-source/raw/structured/0-2_world_rules.yaml"]

meta:
  role: cinematic_intent
  version: 1.0
  status: draft

schema:
  type: object
  required: [meta, inputs, content]
  properties:
    meta:
      type: object
      required: [role, version]
      properties:
        role: {type: string}
        version: {type: number}
        status: {type: string}
    inputs:
      type: object
      required: [from_docs]
      properties:
        from_docs:
          type: array
          items: {type: string}
  content:
    type: object
    required: [intent_summary, global_style, segments, shot_intents]
    properties:
      intent_summary:
        type: string
      global_style:
        type: object
        required: [continuity, tone, constraints]
        properties:
          continuity: {type: string}
          tone: {type: string}
          constraints:
            type: array
            items: {type: string}
      segments:
        type: array
        items:
          type: object
          required: [segment, title, summary, beats, primary_mood]
          properties:
            segment: {type: string}
            title: {type: string}
            summary: {type: string}
            beats:
              type: array
              items: {type: string}
            primary_mood: {type: string}
            notes: {type: string}
      shot_intents:
        type: array
        items:
          type: object
          required: [shot, segment, viewing_goal, emphasis, avoid, duration_source, blender_layout_tokens]
          properties:
            shot: {type: string}
            segment: {type: string}
            viewing_goal: {type: string}
            emphasis:
              type: array
              items: {type: string}
            avoid:
              type: array
              items: {type: string}
            duration_sec: {type: number, nullable: true}
            duration_source: {type: string}
            narrative_purpose: {type: string}
            beats:
              type: array
              items: {type: string}
            visuals:
              type: array
              items: {type: string}
            continuity_notes:
              type: array
              items: {type: string}
            blender_layout_tokens:
              type: array
              items: {type: string}
            notes: {type: string}

fields:
  - path: meta.role
    purpose: 文档角色
    type: string
    required: true
    default: cinematic_intent
  - path: meta.version
    purpose: 模板版本
    type: number
    required: true
    default: 1.0
  - path: meta.status
    purpose: 文档状态
    type: string
    required: false
    default: draft
  - path: inputs.from_docs
    purpose: 依赖的上游文档
    type: array[string]
    required: true
    default: ["script_breakdown_v1"]
  - path: content.intent_summary
    purpose: 概括的叙事/视觉意图
    type: string
    required: true
    default: ""
  - path: content.global_style.continuity
    purpose: 视觉/叙事连续性说明
    type: string
    required: true
    default: ""
  - path: content.global_style.tone
    purpose: 全局色调/质感
    type: string
    required: true
    default: ""
  - path: content.global_style.constraints
    purpose: 约束列表
    type: array[string]
    required: true
    default: []
  - path: content.segments[].segment
    purpose: 段落编号
    type: string
    required: true
    default: "segment001"
  - path: content.segments[].title
    purpose: 段落名称
    type: string
    required: true
    default: ""
  - path: content.segments[].summary
    purpose: 段落概述
    type: string
    required: true
    default: ""
  - path: content.segments[].beats
    purpose: 段落节奏点
    type: array[string]
    required: true
    default: []
  - path: content.segments[].primary_mood
    purpose: 主要情绪
    type: string
    required: true
    default: ""
  - path: content.segments[].notes
    purpose: 补充说明
    type: string
    required: false
    default: ""
  - path: content.shot_intents[].shot
    purpose: 镜头编号
    type: string
    required: true
    default: "shot001"
  - path: content.shot_intents[].segment
    purpose: 所属段落
    type: string
    required: true
    default: "segment001"
  - path: content.shot_intents[].viewing_goal
    purpose: 主要观感目标
    type: string
    required: true
    default: ""
  - path: content.shot_intents[].emphasis
    purpose: 强调元素
    type: array[string]
    required: true
    default: []
  - path: content.shot_intents[].avoid
    purpose: 避免元素
    type: array[string]
    required: true
    default: []
  - path: content.shot_intents[].duration_sec
    purpose: 时长
    type: number|null
    required: false
    default: null
  - path: content.shot_intents[].duration_source
    purpose: 时长来源
    type: string
    required: true
    default: "estimate"
  - path: content.shot_intents[].narrative_purpose
    purpose: 镜头叙事目的
    type: string
    required: false
    default: ""
  - path: content.shot_intents[].beats
    purpose: 镜头关联节奏点
    type: array[string]
    required: false
    default: []
  - path: content.shot_intents[].visuals
    purpose: 视觉关键词
    type: array[string]
    required: false
    default: []
  - path: content.shot_intents[].continuity_notes
    purpose: 连续性说明
    type: array[string]
    required: false
    default: []
  - path: content.shot_intents[].blender_layout_tokens
    purpose: Blender 布局 tokens
    type: array[string]
    required: true
    default: []
  - path: content.shot_intents[].notes
    purpose: 补充说明
    type: string
    required: false
    default: ""

content:
  intent_summary: "以工业质感为核心，确保冷暖对比与方向一致，三个驱动分支分别聚焦段落、镜头和 Blender 布局 token。"
  global_style:
    continuity: "保持角色移动方向与景深一致，避免反向切换；光线渐进但保持冷色调基底。"
    tone: "工业质感 + 霓虹对比，节奏由近景压迫延伸到远景呼吸。"
    constraints:
      - "避免摇摄与快速切换，Favours slow push/track"
      - "镜头内确保主要道具始终在画面右侧1/3"
  segments:
    - segment: "segment001"
      title: "控制室紧张"
      summary: "角色在控制台触发预警，节奏明快，光线聚焦于屏幕与手部。"
      beats:
        - "Lead 操作控制台"
        - "提示挂在墙上"
      primary_mood: "压迫"
      notes: "用于段落文生视频 prompt 的描述，强调光影与手部动作。"
  shot_intents:
    - shot: "shot001"
      segment: "segment001"
      viewing_goal: "表现角色在控制室的焦灼与紧张。"
      emphasis:
        - "手部细节"
        - "冷蓝光照在面部与控制面板"
      avoid:
        - "多余背景反光"
        - "快速快门"
      duration_sec: 4.0
      duration_source: "timeline_xml"
      narrative_purpose: "建立主角焦虑并引出下一场节奏变化。"
      beats: ["Lead 盯着屏幕", "屏幕跳红色警告"]
      visuals: ["工业面板", "霓虹光束"]
      continuity_notes:
        - "保持从左到右的摄像移动"
      blender_layout_tokens:
        - "camera: push_in"
        - "lighting: cold_fill"
        - "props: console|led_panel"
      notes: "分支2 prompt 需要重点说明手部/光影；Blender token 指定 push_in + 冷色灯光。"
    - shot: "shot002"
      segment: "segment001"
      viewing_goal: "展示外部城市节奏与对比，让观众感受到世界脉动。"
      emphasis:
        - "城市线条"
        - "机械纹理"
      avoid:
        - "晃动镜头"
      duration_sec: 5.0
      duration_source: "estimate"
      narrative_purpose: "扩展世界观，平衡内外紧张程度。"
      beats: ["镜头拉至窗外", "机械列车经过"]
      visuals: ["霓虹轴线", "湿润街道"]
      continuity_notes:
        - "镜头与 shot001 保持城市方向一致"
      blender_layout_tokens:
        - "camera: track"
        - "lighting: neon_fill"
        - "props: city_rail|wet_street"
      notes: "分支3 token 需描述 track+霓虹，确保 Blender 布局保持方向同步。"

example:
  meta: {role: cinematic_intent, version: 1.0, status: draft}
  inputs:
    from_docs: ["script_breakdown_v1"]
  content:
    intent_summary: "以冷暖对比突出工业张力，镜头移动保持方向一致，使情绪逐渐上升。"
    global_style:
      continuity: "保持方向/景深一致"
      tone: "工业冷暖对比"
      constraints:
        - "摄影方向始终由左向右"
        - "避免过度摇摄"
    segments:
      - segment: "segment001"
        title: "控制室紧张"
        summary: "角色在控制台触发预警"
        beats:
          - "Lead 操作控制台"
          - "屏幕跳红色警告"
        primary_mood: "压迫"
        notes: "段落 prompt 需强调灯光与手部动作"
    shot_intents:
      - shot: "shot001"
        segment: "segment001"
        viewing_goal: "说明角色在控制室的焦灼"
        emphasis: ["冷色光", "手部慢动作"]
        avoid: ["闪烁灯光", "手持不稳"]
        duration_sec: 4.0
        duration_source: "timeline_xml"
        narrative_purpose: "建立紧张基调"
        beats: ["Lead 盯着屏幕", "警报声"]
        visuals: ["工业面板"]
        continuity_notes: ["由左向右推镜头"]
        blender_layout_tokens: ["camera: push_in", "lighting: cold_fill"]
        notes: "branch2 prompt 与 branch3 tokens"

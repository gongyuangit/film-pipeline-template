meta:
  role: segment_story_test
  version: 1.0
  status: draft

schema:
  type: object
  required: [meta, purpose, inputs, protocol, outputs, gate]
  properties:
    meta:
      type: object
      required: [role, version]
      properties:
        role: {type: string}
        version: {type: number}
        status: {type: string}
    purpose: {type: string}
    inputs:
      type: object
      required: [from_docs]
      properties:
        from_docs:
          type: array
          items: {type: string}
    protocol:
      type: object
      required: [checklist]
      properties:
        checklist:
          type: object
          required: [readability, emotional_arc, conflict_progression, causality, exit_point]
          properties:
            readability: {type: string}
            emotional_arc: {type: string}
            conflict_progression: {type: string}
            causality: {type: string}
            exit_point: {type: string}
    outputs:
      type: object
      required: [segment_results]
      properties:
        segment_results:
          type: array
          items:
            type: object
            required: [segment, pass, issues, corrected_beats]
            properties:
              segment: {type: string}
              pass: {type: boolean}
              issues:
                type: array
                items: {type: string}
              corrected_beats:
                type: array
                items:
                  type: object
                  required: [id, description]
                  properties:
                    id: {type: string}
                    description: {type: string}
    gate:
      type: object
      required: [pass_to]
      properties:
        pass_to: {type: string}

fields:
  - path: meta.role
    purpose: 文档角色标识
    type: string
    required: true
    default: segment_story_test
  - path: meta.version
    purpose: 模板版本
    type: number
    required: true
    default: 1.0
  - path: meta.status
    purpose: 文档状态
    type: string
    required: false
    default: draft
  - path: purpose
    purpose: 流程目标说明
    type: string
    required: true
    default: ""
  - path: inputs.from_docs
    purpose: 上游依赖文档编号
    type: array[string]
    required: true
    default: []
  - path: protocol.checklist.*
    purpose: 测试项标准说明
    type: string
    required: true
    default: ""
  - path: outputs.segment_results[].segment
    purpose: 对应段落编号
    type: string
    required: true
    default: "segment001"
  - path: outputs.segment_results[].pass
    purpose: 是否通过测试
    type: boolean
    required: true
    default: false
  - path: outputs.segment_results[].issues
    purpose: 发现的问题列表
    type: array[string]
    required: true
    default: []
  - path: outputs.segment_results[].corrected_beats[]
    purpose: 修正后的节拍建议
    type: array[object]
    required: true
    default: []
  - path: gate.pass_to
    purpose: 通过后进入的下游文档编号
    type: string
    required: true
    default: 1-4_shot_narrative

purpose: "段落式剧情测试：验证段落可读性、因果与节拍，不讨论镜头语言。"
inputs:
  from_docs:
    - "1-2_segment_structure"
    - "1-3_segment_drama"
    - "0-2_world_rules"
    - "0-3_assets_entities"
    - "X-1_segment_story_prompts"
    - "X-4_prompt_input"
    - "X-5_token_input"
protocol:
  checklist:
    readability: ""
    emotional_arc: ""
    conflict_progression: ""
    causality: ""
    exit_point: ""
outputs:
  segment_results:
    - segment: "segment001"
      pass: false
      issues: []
      corrected_beats:
        - {id: "beat001", description: "节拍占位"}

gate:
  pass_to: "1-4_shot_narrative"

example:
  meta: {role: segment_story_test, version: 1.0, status: draft}
  purpose: "验证段落可读性与节拍合理性"
  inputs:
    from_docs: ["1-2_segment_structure", "1-3_segment_drama", "X-1_segment_story_prompts", "X-4_prompt_input", "X-5_token_input"]
  protocol:
    checklist:
      readability: "段落是否可单独理解"
      emotional_arc: "情绪是否有起伏"
      conflict_progression: "冲突是否推进"
      causality: "因果是否自洽"
      exit_point: "结尾是否引出下段"
  outputs:
    segment_results:
      - segment: "segment001"
        pass: true
        issues: []
        corrected_beats:
          - {id: "beat001", description: "节拍顺序清晰"}
  gate:
    pass_to: "1-4_shot_narrative"

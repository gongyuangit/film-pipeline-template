meta:
  role: ingest_bridge
  version: 1.0

bridge:
  inputs:
    timeline_xml_dir: "01_inputs/timeline_xml"
    timeline_srt_dir: "01_inputs/timeline_srt"
  outputs:
    parsed_cache_dir: "03_work/ingest_cache"
    logs_dir: "03_work/logs"

srt_tags:
  segment: "[SEG]"
  beat: "[BEAT]"
  shot: "[SHOT]"
  intent: "[INTENT]"
  look: "[LOOK]"
  exec: "[EXEC]"
  continuity: "[CONT]"

ingest_to_docs:
  xml:
    extract: ["clip_name","clip_start","clip_end","clip_duration_sec","track"]
    write_back:
      - {doc: "00_docs/1_story/1-5_shot_list.yaml",    key: "shot", field: "content.shots[].duration_sec"}
      - {doc: "00_docs/2_layout/2-2_layout_freeze.yaml", key: "shot", field: "content.shots[].camera.duration_sec"}

  srt:
    extract: ["time_range","text"]
    route_by_tag:
      - {when_tag: "[SEG]",  doc: "00_docs/1_story/1-3_segment_drama.yaml",        field: "content.segments[].notes"}
      - {when_tag: "[BEAT]", doc: "00_docs/1_story/1-3a_segment_story_test.yaml",  field: "outputs.segment_results[].corrected_beats"}
      - {when_tag: "[SHOT]", doc: "00_docs/1_story/1-4_shot_narrative.yaml",       field: "content.shots[].narrative_purpose"}
      - {when_tag: "[INTENT]",doc:"00_docs/2_layout/2-1_cinematic_intent.yaml",    field: "content.shot_intents[]"}
      - {when_tag: "[LOOK]", doc: "00_docs/3_lookdev/3-1_lookdev.yaml",            field: "content.per_shot_notes[]"}
      - {when_tag: "[EXEC]", doc: "00_docs/X_exec/X-0_execution_tokens.yaml",      field: "tokens.positive.shared"}
      - {when_tag: "[CONT]", doc: "00_docs/2_layout/2-2_layout_freeze.yaml",       field: "content.shots[].spatial.continuity_notes"}

srt_authoring_examples:
  - "00:00:01,000 --> 00:00:04,000  [SHOT] shot001 镜头叙事：引出核心道具"
  - "00:00:04,000 --> 00:00:08,000  [CONT] 道具位置保持画面中心，连续到 shot003"
  - "00:00:08,000 --> 00:00:12,000 [LOOK] 风格关键词：写实、薄雾、体积光"
